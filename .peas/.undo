{
  "Update": {
    "id": "peas-0ktvu",
    "file_path": "D:\\Development\\Shared\\PROJECT_LAB\\peas\\.peas\\peas-0ktvu--decompose-tui-app-god-object-app-rs-2107-loc.md",
    "previous_content": "+++\nid = \"peas-0ktvu\"\ntitle = \"Decompose TUI App god object (app.rs 2107 LOC)\"\ntype = \"chore\"\nstatus = \"in-progress\"\npriority = \"high\"\ncreated = \"2026-01-20T10:25:04.413446300Z\"\nupdated = \"2026-01-20T11:40:00.343964500Z\"\n+++\n\n# TUI app.rs Refactor - Phase 1 In Progress\n\n## Goal\nReduce src/tui/app.rs from 2107 LOC to ~450 LOC by extracting into focused modules.\n\n## Overall Plan (8 Phases)\n1. â³ **Phase 1**: Extract event handlers (642 LOC â†’ 15 files)\n2. ðŸ“‹ Phase 2: Extract state management (45 fields â†’ 4 structs)\n3. ðŸ“‹ Phase 3: Extract data management (430 LOC â†’ 4 files)\n4. ðŸ“‹ Phase 4: Extract modal operations (420 LOC â†’ 9 files)\n5. ðŸ“‹ Phase 5: Extract content utilities (137 LOC â†’ 3 files)\n6. ðŸ“‹ Phase 6: Move type definitions (93 LOC â†’ models.rs)\n7. ðŸ“‹ Phase 7: Final app.rs refactor & integration\n8. ðŸ“‹ Phase 8: Update module exports\n\n## Phase 1 Progress: Event Handlers\n\n### âœ… Completed\n- Created `src/tui/handlers/` directory\n- Created `handlers/mod.rs` module file\n- **Extracted normal_mode.rs (165 LOC)**\n  - 30+ keybindings (q, ?, Tab, j/k, Enter, Space, s, p, t, etc.)\n  - Navigation, modal opening, actions\n  - Compiles successfully\n\n### ðŸš§ Remaining in Phase 1 (14 handlers, ~480 LOC)\nExtract these from run_app() match statement in app.rs:\n\n1. **filter.rs** (~15 LOC, lines ~1676-1690)\n   - Handle search input (Esc, Enter, character input)\n\n2. **modal_status.rs** (~15 LOC, lines ~1690-1710)\n   - Status modal navigation (Up/Down, Enter, Esc)\n\n3. **modal_priority.rs** (~15 LOC, lines ~1711-1731)\n   - Priority modal navigation (Up/Down, Enter, Esc)\n\n4. **modal_type.rs** (~15 LOC, lines ~1732-1752)\n   - Type modal navigation (Up/Down, Enter, Esc)\n\n5. **modal_delete.rs** (~15 LOC, lines ~1753-1761)\n   - Delete confirmation (y/n/Esc)\n\n6. **modal_parent.rs** (~15 LOC, lines ~1762-1782)\n   - Parent selection (Up/Down, Enter, Esc)\n\n7. **modal_blocking.rs** (~25 LOC, lines ~1783-1810)\n   - Blocking multi-select (Up/Down, Space, Enter, Esc)\n\n8. **detail_view.rs** (~90 LOC, lines ~1811-1943)\n   - Detail pane navigation (Tab, j/k, Enter, e, o, Esc)\n   - Complex with multiple sub-panes\n\n9. **modal_create.rs** (~35 LOC, lines ~1944-1993)\n   - Ticket creation form (Tab, Enter, Esc, character input)\n\n10. **modal_memory_create.rs** (~35 LOC, lines ~1994-2031)\n    - Memory creation form (Tab, Enter, Esc, character input)\n\n11. **edit_body.rs** (~25 LOC, lines ~2032-2054)\n    - TextArea passthrough (Ctrl+S, Esc)\n\n12. **modal_tags.rs** (~15 LOC, lines ~2055-2071)\n    - Tags input (Enter, Esc, character input)\n\n13. **modal_url.rs** (~20 LOC, lines ~2072-2095)\n    - URL selection (Up/Down, Enter, Esc)\n\n14. **Mouse handling** (already in run_app, lines ~1490-1527)\n    - Keep in run_app() or extract to mouse.rs\n\n### Next Steps for Phase 1\n1. Extract each of the 14 remaining handlers into separate files\n2. Update `handlers/mod.rs` to declare and re-export all handlers\n3. Refactor `run_app()` to dispatch to handlers:\n   ```rust\n   match app.input_mode {\n       InputMode::Normal => handlers::normal_mode::handle(&mut app, key, terminal)?,\n       InputMode::Filter => handlers::filter::handle(&mut app, key)?,\n       // ... etc\n   }\n   ```\n4. Test all functionality in TUI\n5. Commit Phase 1 completion\n\n### Handler Function Signature Pattern\n```rust\npub fn handle(\n    app: &mut App,\n    key: KeyEvent,\n    terminal: Option<&mut Terminal<CrosstermBackend<io::Stdout>>>\n) -> io::Result<bool> // Returns true to quit\n```\n\n## Reference Files\n- **Plan**: C:\\Users\\asaaki\\.claude\\plans\\functional-drifting-kahan.md\n- **Current commit**: WIP Phase 1 - Normal mode extracted\n- **Line numbers**: Based on original app.rs before extraction\n\n## Testing Checklist (After Phase 1)\n- [ ] Launch TUI: `cargo run -- tui`\n- [ ] Test Normal mode navigation (j/k, arrows, page up/down)\n- [ ] Test filtering (/)\n- [ ] Test all modals (s, p, t, P, B, T, D)\n- [ ] Test detail view (Enter, Tab, e)\n- [ ] Test view switching (Tab in Normal mode)\n- [ ] Test multi-select (Space) and bulk operations\n- [ ] Test creation (c, n)\n- [ ] Test undo (u)\n- [ ] Test URL opening (o)\n\nAll behavior must remain identical - this is a pure refactor.\n"
  }
}